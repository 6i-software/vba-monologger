
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="Learn about log handlers in VBA Monologger. Understand their role in directing log to specific outputs with custom formatters and levels.">
    <link rel="canonical" href="https://6i-software.github.io/vba-monologger/under-the-hood/handler.html">
    <meta name="author" content="2o1oo <vb20100bv@gmail.com>">
    <link rel="prev" href="formatter.html">
    <link rel="next" href="pre-processor.html">
    <link rel="icon" href="../assets/logo.png">
    <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">

    
    <title>VBA Monologger - Handler</title>

    
      <link rel="stylesheet" href="../assets/stylesheets/main.d7758b05.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/css/extra-customize.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-LT06F6P562"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-LT06F6P562",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-LT06F6P562",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
    <meta name="google-site-verification" content="232S62jZFxoHqiZjIoVueSZT-LjT3NGHUMUqzahLLKI" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="VBA Monologger" />
    <meta name="twitter:creator" content="2o1oo" />
    <meta property="og:title" content="VBA Monologger - Handler" />
    <meta property="og:description" content="Learn about log handlers in VBA Monologger. Understand their role in directing log to specific outputs with custom formatters and levels." />
    <meta property="og:image" content="https://6i-software.github.io/vba-monologger/assets/logo.png" />
    <meta property="og:url" content="https://6i-software.github.io/vba-monologger/under-the-hood/handler.html" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="VBA Monologger" />
    <meta property="og:locale" content="en_US" />
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "url": "https://6i-software.github.io/vba-monologger/",
            "name": "VBA Monologger",
            "description": "Learn about log handlers in VBA Monologger. Understand their role in directing log to specific outputs with custom formatters and levels.",
            "publisher": {
                "@type": "Organization",
                "name": "6i Software"
            }
        }
    </script>

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#concept" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="VBA Monologger" class="md-header__button md-logo" aria-label="VBA Monologger" data-md-component="logo">
      
  <img src="../assets/logo_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            VBA Monologger
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Handler
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/6i-software/vba-monologger" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    6i-software/vba-monologger
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
    
  
  Welcome

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../getting-started/introduction.html" class="md-tabs__link">
          
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="index.html" class="md-tabs__link">
          
  
    
  
  Under the hood

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../blog/index.html" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="VBA Monologger" class="md-nav__button md-logo" aria-label="VBA Monologger" data-md-component="logo">
      
  <img src="../assets/logo_white.png" alt="logo">

    </a>
    VBA Monologger
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/6i-software/vba-monologger" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    6i-software/vba-monologger
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/introduction.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/install.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/quick-start.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Usages
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Usages
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/usages/channel.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Identify a logger with a channel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/usages/add-context-data-to-log-messages.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add context data to log messages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/usages/add-pre-processor.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add extra data to log messages via a pre-processor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/usages/create-custom-formatter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a custom formatter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/usages/create-custom-logger.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a custom logger from scratch
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/usages/create-null-logger.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a null logger
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/usages/inject-logger-into-custom-class-module.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dependency injection for logging capabilities in a custom class module
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Under the hood
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Under the hood
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="log-severity-levels.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Log severity levels
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="log-record.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Log record
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="formatter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Formatter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Handler
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="handler.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Handler
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concept" class="md-nav__link">
    <span class="md-ellipsis">
      Concept
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modeling" class="md-nav__link">
    <span class="md-ellipsis">
      Modeling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handlerconsolevba" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerConsoleVBA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HandlerConsoleVBA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-new-handlerconsolevba" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a new HandlerConsoleVBA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changing-the-formatter-of-handler" class="md-nav__link">
    <span class="md-ellipsis">
      Changing the formatter of handler
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handlerfile" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerFile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HandlerFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-new-handlerfile" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a new HandlerFile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supporting-utf-8" class="md-nav__link">
    <span class="md-ellipsis">
      Supporting UTF-8
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modifying-the-name-and-destination-of-the-log-file" class="md-nav__link">
    <span class="md-ellipsis">
      Modifying the name and destination of the log file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handlerconsole" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerConsole
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HandlerConsole">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vbamonologger-http-client" class="md-nav__link">
    <span class="md-ellipsis">
      VBAMonologger HTTP client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vbamonologger-http-server-logs-viewer" class="md-nav__link">
    <span class="md-ellipsis">
      VBAMonologger HTTP server logs viewer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VBAMonologger HTTP server logs viewer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-the-server-manually-in-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the server manually in powershell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-an-http-server-in-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Create an HTTP server in powershell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enhanced-server-processing-requests-client" class="md-nav__link">
    <span class="md-ellipsis">
      Enhanced server processing request's client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enhanced-server-console-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Enhanced server console outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedding-powershell-server-code-into-a-vba-library" class="md-nav__link">
    <span class="md-ellipsis">
      Embedding PowerShell server code into a VBA library
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-start-the-vbamonologger-server-logs-viewer-from-vba" class="md-nav__link">
    <span class="md-ellipsis">
      How to start the VBAMonologger server logs viewer from VBA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pre-processor.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pre-processor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="logger.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logger
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../blog/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/archive/2025.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/archive/2024.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categories
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../blog/category/blog.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concept" class="md-nav__link">
    <span class="md-ellipsis">
      Concept
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modeling" class="md-nav__link">
    <span class="md-ellipsis">
      Modeling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handlerconsolevba" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerConsoleVBA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HandlerConsoleVBA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-new-handlerconsolevba" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a new HandlerConsoleVBA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changing-the-formatter-of-handler" class="md-nav__link">
    <span class="md-ellipsis">
      Changing the formatter of handler
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handlerfile" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerFile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HandlerFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-new-handlerfile" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a new HandlerFile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supporting-utf-8" class="md-nav__link">
    <span class="md-ellipsis">
      Supporting UTF-8
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modifying-the-name-and-destination-of-the-log-file" class="md-nav__link">
    <span class="md-ellipsis">
      Modifying the name and destination of the log file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handlerconsole" class="md-nav__link">
    <span class="md-ellipsis">
      HandlerConsole
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HandlerConsole">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vbamonologger-http-client" class="md-nav__link">
    <span class="md-ellipsis">
      VBAMonologger HTTP client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vbamonologger-http-server-logs-viewer" class="md-nav__link">
    <span class="md-ellipsis">
      VBAMonologger HTTP server logs viewer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VBAMonologger HTTP server logs viewer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-the-server-manually-in-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the server manually in powershell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-an-http-server-in-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Create an HTTP server in powershell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enhanced-server-processing-requests-client" class="md-nav__link">
    <span class="md-ellipsis">
      Enhanced server processing request's client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enhanced-server-console-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Enhanced server console outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedding-powershell-server-code-into-a-vba-library" class="md-nav__link">
    <span class="md-ellipsis">
      Embedding PowerShell server code into a VBA library
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-start-the-vbamonologger-server-logs-viewer-from-vba" class="md-nav__link">
    <span class="md-ellipsis">
      How to start the VBAMonologger server logs viewer from VBA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Handler</h1>

<h2 id="concept">Concept<a class="headerlink" href="#concept" title="Permanent link">&para;</a></h2>
<p>A log handler is the key component responsible for processing each log entry. When a log message is generated, it is not simply recorded; it must be directed to a location where it can be viewed and used. This is where the handler comes in, determining where and how each log entry will be sent or saved. </p>
<p>A log handler is responsible for directing log messages to specific outputs, such as file, console or database , and based on the log level and other configuration settings like bubble propagation.</p>
<h2 id="modeling">Modeling<a class="headerlink" href="#modeling" title="Permanent link">&para;</a></h2>
<p>The interface <code>VBAMonologger.Handler.HandlerInterface</code> defines the standard behavior that all handler implementations must follow. </p>
<p>It provides a standardized, modular way to add various logging handlers without needing to change client code. By implementing this interface, different handlers can easily be added to support new output targets or custom logging behavior as needed. Handlers can be configured independently with custom formatters, levels, and bubbling behavior, offering fine-grained control over how and where logs are managed.</p>
<pre class="mermaid"><code>classDiagram
    direction TB

    class HandlerInterface {
        &lt;&lt;interface&gt;&gt;
        + level VBAMonologger.LOG_LEVELS
        + FormatterInterface formatter
        + Boolean bubble

        + Boolean isHandling(LogRecordInterface LogRecord)
        + Boolean handle(LogRecordInterface LogRecord)
        + Boolean handleBatch(LogRecordInterface[] logRecords)
        + void closeHandler()
    }

    class LOG_LEVELS {
        &lt;&lt;Enum&gt;&gt;
    }

    class FormatterInterface {
        &lt;&lt;Interface&gt;&gt;
        +Function format(ByRef record As LogRecordInterface) As Variant
        +Function formatBatch(ByRef records() As LogRecordInterface) As Variant
    }


    %% Implementations and relationships
    HandlerConsoleVBA ..|&gt; HandlerInterface: Implements
    HandlerConsole ..|&gt; HandlerInterface: Implements
    HandlerFile ..|&gt; HandlerInterface: Implements

    HandlerInterface --&gt; FormatterInterface : Has (property pFormatter)
    HandlerInterface --&gt; LOG_LEVELS : Uses</code></pre>
<p>This interface specifies the necessary properties and methods to control how and where log records are processed, and it provides the following members.</p>
<p><div class="language-vbscript highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">Public</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">LOG_LEVELS</span>
</span></code></pre></div>
Determines the current log level of handler. This property sets the minimum log level required for the handler to process a log entry. Only messages at or above this level are handled, allowing for filtering of log messages based on severity (e.g., DEBUG, INFO, ERROR).</p>
<p><div class="language-vbscript highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">Public</span><span class="w"> </span><span class="n">Property</span><span class="w"> </span><span class="n">bubble</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Boolean</span>
</span></code></pre></div>
Determines whether, or not, the log record should "bubble up" to other handlers in the stack after being processed by the current handler.</p>
<p>When you have multiple handlers in the stack of your logger, and want a specific handler to be the only one processing certain log levels or messages, you have to set bubble to false for that handler. This is useful if you need specific messages to go only to a certain location.
 - If bubble is set to <code>true</code> (the default), the log record will be processed by the current handler and continue to "bubble up" to other handlers in the stack. This allows multiple handlers to process the same log message.
 - If bubble is set to <code>false</code>, the log record will stop propagating after being processed by the current handler. This essentially "catches" the record, preventing it from being handled by other handlers in the stack.</p>
<p><div class="language-vbscript highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">Public</span><span class="w"> </span><span class="n">Property</span><span class="w"> </span><span class="n">formatter</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">FormatterInterface</span>
</span></code></pre></div>
Specifies the formatter associated with the handler, defining how each log record will be structured and formatted before output. This allows for flexible formatting (e.g., plain text, JSON) based on the formatter assigned to the handler.</p>
<p><div class="language-vbscript highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kd">Function</span><span class="w"> </span><span class="nf">isHandling</span><span class="p">(</span><span class="k">ByRef</span><span class="w"> </span><span class="n">logRecord</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">LogRecordInterface</span><span class="p">)</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Boolean</span>
</span></code></pre></div>
Provides a way for handlers to filter log messages. This ensures that a handler only processes messages that are relevant to it, which can improve performance and reduce unnecessary processing. It returns true if the handler is capable of processing the  log message and false if the handler should not process the log message. This function evaluates if the handler is set to process the given log record based on the log level and other criteria. It returns <code>True</code> if the handler should handle the record, or <code>False</code> if it should be ignored.</p>
<p><div class="language-vbscript highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kd">Function</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="k">ByRef</span><span class="w"> </span><span class="n">logRecord</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">LogRecordInterface</span><span class="p">)</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Boolean</span>
</span></code></pre></div>
All records may be passed to this method, and the handler should discard those that it does not want to handle. The return value of this function controls the bubbling process of the handler stack. Unless the bubbling is interrupted (by returning true), the Logger class will keep on calling further handlers in the stack with a given log record. If the handler can process the record (based on <code>isHandling</code>), it outputs the formatted log message to its designated destination (e.g., console, file). It returns a Boolean value to control the record's propagation through additional handlers, based on the <code>bubble</code> property.</p>
<p><div class="language-vbscript highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kd">Function</span><span class="w"> </span><span class="nf">handleBatch</span><span class="p">(</span><span class="k">ByRef</span><span class="w"> </span><span class="n">logRecords</span><span class="p">()</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">LogRecordInterface</span><span class="p">)</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Boolean</span>
</span></code></pre></div>
This method handles an array of log records at once, processing each record in sequence. It provides an efficient way to process bulk log entries, making it ideal for scenarios where multiple messages need to be logged simultaneously.</p>
<p><div class="language-vbscript highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kd">Sub</span><span class="w"> </span><span class="nf">closeHandler</span><span class="p">()</span>
</span></code></pre></div>
This method releases any resources or open connections the handler may use (e.g., closing file handles or flushing data). It ensures a proper shutdown of the logging cycle and frees up resources when logging is complete.</p>
<h2 id="handlerconsolevba">HandlerConsoleVBA<a class="headerlink" href="#handlerconsolevba" title="Permanent link">&para;</a></h2>
<p>The <code>VBAMonologger.Handler.HandlerConsoleVBA</code> class is responsible for directing log messages into the VBA Console (i.e. the Immediate window in Excel). </p>
<pre class="mermaid"><code>classDiagram
    direction TB

    class HandlerConsoleVBA {
        - LogLevel pLevel
        - FormatterInterface pFormatter
        - Boolean pBubble

        + construct(Boolean paramBubble, LOG_LEVELS paramLevel): HandlerInterface
        + Boolean isHandling(LogRecordInterface LogRecord)
        + Boolean handle(LogRecordInterface LogRecord)
        + Boolean handleBatch(LogRecordInterface[] logRecords)
        + void closeHandler()
        + String toString() 
    }

    class HandlerInterface {
        &lt;&lt;Interface&gt;&gt;
    }

    class StringableInterface {
        &lt;&lt;Interface&gt;&gt;
    }    

    %% Implementations and relationships
    HandlerConsoleVBA ..|&gt; StringableInterface : Implements
    HandlerConsoleVBA ..|&gt; HandlerInterface: Implements
    HandlerInterface --&gt; FormatterInterface : Has (property pFormatter)
    HandlerInterface --&gt; LOG_LEVELS : Uses</code></pre>
<h3 id="creating-a-new-handlerconsolevba">Creating a new <code>HandlerConsoleVBA</code><a class="headerlink" href="#creating-a-new-handlerconsolevba" title="Permanent link">&para;</a></h3>
<p>Below is an example of how to create an instance of handler console VBA.</p>
<div class="language-vbscript highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kd">Dim</span><span class="w"> </span><span class="nv">handlerConsole</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">HandlerInterface</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">Set</span><span class="w"> </span><span class="n">handlerConsole</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">HandlerConsoleVBA</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="n">handlerConsole</span><span class="p">.</span><span class="n">toString</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;=== Handle a log record with HandlerConsoleVBA ===&quot;</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="kd">Dim</span><span class="w"> </span><span class="nv">record</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">LogRecord</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="k">Set</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">LogRecord</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="k">Set</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="n">construct</span><span class="p">(</span><span class="w"> </span><span class="n">_</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="s2">&quot;Process completed successfully with minor issues for user.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">LEVEL_INFO</span><span class="p">,</span><span class="w"> </span><span class="n">_</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="s2">&quot;App&quot;</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="p">)</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="kd">Dim</span><span class="w"> </span><span class="nv">isHandling</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Boolean</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="n">isHandling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handlerConsole</span><span class="p">.</span><span class="n">isHandling</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;&gt;&gt;&gt; Result of handlerConsole.isHandling(record): &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">isHandling</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;&gt;&gt;&gt; Result of handlerConsole.handle(record): &quot;</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="n">handlerConsole</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="n">record</span>
</span></code></pre></div>
<div class="language-text highlight"><span class="filename">Result</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>[VBAMonologger.Handler.HandlerConsoleVBA]
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a> | level: DEBUG
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a> | bubble: true
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>=== Handle a log record with HandlerConsoleVBA ===
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>&gt;&gt;&gt; Result of handler.isHandling(dummyRecord): True
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>&gt;&gt;&gt; Result of handler.handle(dummyRecord): 
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>[2024/11/13 10:42:03] App.INFO: Process completed successfully with minor issues for user.
</span></code></pre></div>
<h3 id="changing-the-formatter-of-handler">Changing the formatter of handler<a class="headerlink" href="#changing-the-formatter-of-handler" title="Permanent link">&para;</a></h3>
<p>The <code>HandlerConsoleVBA</code> class leverages a <code>FormatterInterface</code> to define the structure and appearance of each log entry, ensuring a specific, consistent format that makes log messages easier to read and understand in the console. </p>
<p>By default, <code>HandlerConsoleVBA</code> uses the <code>FormatterLine</code> implementation of the <code>FormatterInterface</code>, which outputs each log entry in a simple, line-based format optimized for console viewing. Additionally, <code>HandlerConsoleVBA</code> is set with a default log level of <code>DEBUG</code>.</p>
<div class="language-vbscript highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kd">Dim</span><span class="w"> </span><span class="nv">handler</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">HandlerConsoleVBA</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="k">Set</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">HandlerConsoleVBA</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="kd">Dim</span><span class="w"> </span><span class="nv">formatterLine</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">FormatterLine</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="k">Set</span><span class="w"> </span><span class="n">formatterLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">FormatterLine</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="n">formatterLine</span><span class="p">.</span><span class="n">showContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">False</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="n">formatterLine</span><span class="p">.</span><span class="n">showExtra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">False</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="k">Set</span><span class="w"> </span><span class="n">handler</span><span class="p">.</span><span class="n">formatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formatterLine</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;=== Handle a collection of log records with default log level &quot;</span><span class="nb">DEBUG</span><span class="s2">&quot; ===&quot;</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="n">handler</span><span class="p">.</span><span class="n">toString</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;&gt;&gt;&gt; Result of handler.handleBatch(records): &quot;</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="n">handler</span><span class="p">.</span><span class="n">handleBatch</span><span class="w"> </span><span class="n">randomLogRecordsForEachLevel</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;=== Change level of handler to CRITICAL ===&quot;</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="n">handler</span><span class="p">.</span><span class="n">level</span><span class="p">.</span><span class="n">currentLogLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">LOG_LEVELS</span><span class="p">.</span><span class="n">LEVEL_CRITICAL</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="n">handler</span><span class="p">.</span><span class="n">toString</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;&gt;&gt;&gt; Result of handler.handleBatch(records): &quot;</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="n">handler</span><span class="p">.</span><span class="n">handleBatch</span><span class="w"> </span><span class="n">randomLogRecordsForEachLevel</span>
</span></code></pre></div>
<div class="language-text highlight"><span class="filename">Result</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>=== Handle a collection of log records with default log level &quot;DEBUG&quot; ===
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>[VBAMonologger.Handler.HandlerConsoleVBA]
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a> | level: DEBUG
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a> | bubble: true
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a> &gt;&gt;&gt; Result of handler.handleBatch(records): 
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>[2024/11/13 10:42:03] App.Authentification.EMERGENCY: A critical failure occurred in the application for {Operation} process
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>[2024/11/13 10:42:03] App.Authentification.ALERT: Action required for process {Operation} failure.
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>[2024/11/13 10:42:03] App.Authentification.CRITICAL: System is in an unstable state. Unable to authenticate {UserId}.
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>[2024/11/13 10:42:03] App.Authentification.ERROR: An error occurred when the user {UserId} try to {Operation} the file {file}. 
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>[2024/11/13 10:42:03] App.Authentification.WARNING: The user {UserId} does not exist. Unable to perform &#39;{Operation}&#39; user file. 
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>[2024/11/13 10:42:03] App.Authentification.NOTICE: Process completed successfully with minor issues for {UserId}. 
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>[2024/11/13 10:42:03] App.Authentification.INFO: User {UserId} has logged in successfully.
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>[2024/11/13 10:42:03] App.Authentification.DEBUG: Authentification function call for user {UserId}. 
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>=== Change level of handler to &quot;CRITICAL&quot; === 
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>[VBAMonologger.Handler.HandlerConsoleVBA]
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a> | level: CRITICAL
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a> | bubble: true
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>&gt;&gt;&gt; Result of handler.handleBatch(records):
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>[2024/11/13 10:42:03] App.Authentification.EMERGENCY: A critical failure occurred in the application for {Operation} process
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>[2024/11/13 10:42:03] App.Authentification.ALERT: Action required for process {Operation} failure.
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>[2024/11/13 10:42:03] App.Authentification.CRITICAL: System is in an unstable state. Unable to authenticate {UserId}.
</span></code></pre></div>
<p>In the example above, the <code>HandlerConsoleVBA</code> object is first instantiated and configured to display logs in the VBA console using a custom formatter, where the <code>showContext</code> and <code>showExtra</code> options are disabled. This means that contextual and additional information will be excluded from the output.</p>
<p>Next, <code>handlerConsole</code> processes a set of log messages covering all severity levels (from DEBUG to EMERGENCY). Since the default log level is set to <code>DEBUG</code>, all log entries are displayed in the console.</p>
<p>In the second part of the example, the log level of <code>handlerConsole</code> is changed to <code>CRITICAL</code>, meaning that only messages with a <code>CRITICAL</code> severity level or higher (such as ALERT and EMERGENCY) will be displayed. As a result, entries with lower severity levels (ERROR, WARNING, etc.) are excluded and do not appear in the output.</p>
<h2 id="handlerfile">HandlerFile<a class="headerlink" href="#handlerfile" title="Permanent link">&para;</a></h2>
<p>The <code>VBAMonologger.Handler.HandlerFile</code> class is responsible for managing and logging messages to a file. This class implements the <code>VBAMonologger.Handler.HandlerInterface</code>, which specifies the methods and properties that a logging handler must provide.</p>
<pre class="mermaid"><code>classDiagram
    direction TB

    class HandlerFile {
        - FormatterInterface pFormatter
        - Boolean pBubble
        - logLevel pLevel
        - String pLogFileName
        - String pLogFileFolder
        - String pLogfilePath
        - Variant pFolderCreated
        - Scripting.FileSystemObject pFileSystemObject
        - Object ADODB.Stream pLogFileStream
        - Boolean pLockFile

        + construct(...): HandlerInterface
        + Property Get formatter() As FormatterInterface
        + Property Set formatter(ByRef newFormatter As FormatterInterface)
        + Property Get bubble() As Boolean
        + Property Let bubble(ByVal value As Boolean)
        + Property Get level() As logLevel
        + Property Set level(ByVal newLogLevel As logLevel)
        + Function isHandling(LogRecordInterface paramLogRecord) As Boolean
        + Function handle(LogRecordInterface paramLogRecord) As Boolean
        + Function handleBatch(LogRecordInterface[] paramLogRecords) As Boolean
        + Sub closeHandler()
        + Property Get logFileName() As String
        + Property Let logFileName(ByVal newLogFileName As String)
        + Property Get logFileFolder() As String
        + Property Let logFileFolder(ByVal newLogFileFolder As String)
        + Property Get logFilePath() As String
        + Function toString() As String
    }

    class HandlerInterface {
        &lt;&lt;Interface&gt;&gt;
    }

    class StringableInterface {
        &lt;&lt;Interface&gt;&gt;
    }

    %% Implementations and relationships
    HandlerFile ..|&gt; StringableInterface : Implements
    HandlerFile ..|&gt; HandlerInterface: Implements
    HandlerInterface --&gt; FormatterInterface : Has (property pFormatter)
    HandlerInterface --&gt; LOG_LEVELS : Uses
    HandlerFile --&gt; FileSystemObject : Uses
    HandlerFile --&gt; ADODB-Stream : Uses</code></pre>
<p>We have several members that are used to configure and manage the handler log file:</p>
<table>
<thead>
<tr>
<th><strong>Property</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>logFileName</code></td>
<td>The name of the log file. This name can be customized.</td>
</tr>
<tr>
<td><code>logFileFolder</code></td>
<td>To retrieve and set the folder where the log file will be stored.</td>
</tr>
<tr>
<td><code>logFilePath</code></td>
<td>To get the full path to the log file, built by concatenation of  <code>logFileFolder</code> with <code>logFileName</code>.</td>
</tr>
<tr>
<td><code>pFolderCreated</code></td>
<td><em>(Private)</em> To showing whether the log folder has been successfully created.</td>
</tr>
<tr>
<td><code>pFileSystemObject</code></td>
<td><em>(Private)</em> An object of <code>FileSystemObject</code> used to interact with the file system (for creating folders and manipulating files).</td>
</tr>
<tr>
<td><code>pLogFileStream</code></td>
<td><em>(Private)</em> An object of <code>ADODB.Stream</code> used to manage the stream for writing to the log file in UTF-8.</td>
</tr>
<tr>
<td><code>pLockFile</code></td>
<td><em>(Private)</em> An indicator for locking the file, used to control concurrent access to the log file.</td>
</tr>
</tbody>
</table>
<h3 id="creating-a-new-handlerfile">Creating a new <code>HandlerFile</code><a class="headerlink" href="#creating-a-new-handlerfile" title="Permanent link">&para;</a></h3>
<p>Heres how to create a new instance of <code>HandlerFile</code> and handle log records.</p>
<div class="language-vbscript highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kd">Dim</span><span class="w"> </span><span class="nv">handlerFile</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">HandlerFile</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="k">Set</span><span class="w"> </span><span class="n">handlerFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">HandlerFile</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="n">handlerFile</span><span class="p">.</span><span class="n">toString</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="c1">&#39; Change the default formatter to a ANSI colored line formatter </span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="kd">Dim</span><span class="w"> </span><span class="nv">formatterAnsiColoredLine</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">formatterAnsiColoredLine</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="k">Set</span><span class="w"> </span><span class="n">formatterAnsiColoredLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">formatterAnsiColoredLine</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="k">Set</span><span class="w"> </span><span class="n">handlerFile</span><span class="p">.</span><span class="n">formatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formatterAnsiColoredLine</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="c1">&#39; Change the default log level of handler to `ERROR`</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="n">handlerFile</span><span class="p">.</span><span class="n">level</span><span class="p">.</span><span class="n">currentLogLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">LOG_LEVELS</span><span class="p">.</span><span class="n">LEVEL_ERROR</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="c1">&#39; Handle a log record with HandlerFile</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="kd">Dim</span><span class="w"> </span><span class="nv">record</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">LogRecord</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="k">Set</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">LogRecord</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="k">Set</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">record</span><span class="p">.</span><span class="n">construct</span><span class="p">(</span><span class="w"> </span><span class="n">_</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">    </span><span class="s2">&quot;Process completed successfully with minor issues for user.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">    </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">LEVEL_INFO</span><span class="p">,</span><span class="w"> </span><span class="n">_</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">    </span><span class="s2">&quot;App&quot;</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="p">)</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="kd">Dim</span><span class="w"> </span><span class="nv">isHandling</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Boolean</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="kd">Dim</span><span class="w"> </span><span class="nv">resultHandle</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Boolean</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="n">isHandling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handlerFile</span><span class="p">.</span><span class="n">isHandling</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="n">resultHandle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handlerFile</span><span class="p">.</span><span class="n">handle</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="c1">&#39; Close the handler   </span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="n">handlerFile</span><span class="p">.</span><span class="n">closeHandler</span>
</span></code></pre></div>
<div class="language-text highlight"><span class="filename">Result</span><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>[VBAMonologger.Handler.HandlerFile]
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a> | logFileName: vbalogfile_2024-11-13.log
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a> | logfilePath: D:\VBAMonologger\var\log\vbalogfile_2024-11-13.log
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a> | logFileFolder: D:\VBAMonologger\var\log
</span></code></pre></div>
<p>You can open the logfile to view the entry records written in it.</p>
<h3 id="supporting-utf-8">Supporting UTF-8<a class="headerlink" href="#supporting-utf-8" title="Permanent link">&para;</a></h3>
<p>In VBA, a text file can be created using the native <code>Open</code> and <code>Print #</code> methods or the <code>FileSystemObject</code>. The <code>Open</code> method allows you to open a file for writing, and if the file doesnt exist, it will be created. However, by default, text is written using <strong>ANSI</strong> encoding, which is based on the system's language and regional settings (often <strong>Windows-1252</strong> for English or French systems). This encoding does not support non-Latin characters and may cause issues when the file is opened on systems with different encodings.</p>
<p>To ensure compatibility with special and multilingual characters in this <code>HandlerFile</code>, the <strong>UTF-8</strong> encoding is preferred. This can be achieved by using the <code>ADODB.Stream</code> object, which allows you to specify the desired encoding when writing to the file. The <code>ADODB.Stream</code> object is designed to handle data streams, making it ideal for both text and binary file operations. By using UTF-8, the log file can store data in multiple languages and special characters without any loss or corruption of information, unlike with other encodings.</p>
<div class="admonition info">
<p class="admonition-title">Can I change the encoding?</p>
<p>No! For now, there is no plan to provide an option to change the default UTF-8 encoding.</p>
</div>
<h3 id="modifying-the-name-and-destination-of-the-log-file">Modifying the name and destination of the log file<a class="headerlink" href="#modifying-the-name-and-destination-of-the-log-file" title="Permanent link">&para;</a></h3>
<p>Heres how you can modify the log file and its destination folder.</p>
<div class="language-vbscript highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kd">Dim</span><span class="w"> </span><span class="nv">handlerFile</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">HandlerFile</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="k">Set</span><span class="w"> </span><span class="n">handlerFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">VBAMonologger</span><span class="p">.</span><span class="n">HandlerFile</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;=== Change the logfile name ===&quot;</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">handlerFile</span><span class="p">.</span><span class="n">logFileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Amazing-log-file-name.log&quot;</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="n">handlerFile</span><span class="p">.</span><span class="n">toString</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;=== Change the logfile folder ===&quot;</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="n">handlerFile</span><span class="p">.</span><span class="n">logFileFolder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VBA</span><span class="p">.</span><span class="n">Environ</span><span class="o">$</span><span class="p">(</span><span class="s2">&quot;USERPROFILE&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;\VBAMonologger\logs&quot;</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="n">handlerFile</span><span class="p">.</span><span class="n">toString</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;=== Initialize handlerFile with custom logfile name and folder ===&quot;</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="k">Set</span><span class="w"> </span><span class="n">handlerFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handlerFile</span><span class="p">.</span><span class="n">construct</span><span class="p">(</span><span class="w"> </span><span class="n">_</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">  </span><span class="n">paramLogFileName</span><span class="p">:</span><span class="o">=</span><span class="s2">&quot;vba-log-file___&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">format</span><span class="p">(</span><span class="nb">Now</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;yyyy-mm-dd&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;.log&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">  </span><span class="n">paramLogFileFolder</span><span class="p">:</span><span class="o">=</span><span class="n">ThisWorkbook</span><span class="p">.</span><span class="n">Path</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;\var\log&quot;</span><span class="w"> </span><span class="n">_</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="p">)</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="n">handlerFile</span><span class="p">.</span><span class="n">toString</span>
</span></code></pre></div>
<div class="language-text highlight"><span class="filename">Result</span><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>=== Change the logfile name ===
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>[VBAMonologger.Handler.HandlerFile]
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a> | logFileName: Amazing-log-file-name.log
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a> | logfilePath: D:\VBAMonologger\src\var\log\Amazing-log-file-name.log
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a> | logFileFolder: D:\VBAMonologger\src\var\log
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>=== Change the logfile folder ===
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>[VBAMonologger.Handler.HandlerFile]
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a> | logFileName: Amazing-log-file-name.log
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a> | logfilePath: C:\Users\vblain\VBAMonologger\logs\Amazing-log-file-name.log
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a> | logFileFolder: C:\Users\vblain\VBAMonologger\logs
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>=== Initialize handlerFile with custom logfile name and folder ===
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>[VBAMonologger.Handler.HandlerFile]
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a> | logFileName: vba-log-file___2024-11-13.log
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a> | logfilePath: D:\VBAMonologger\src\var\log\vba-log-file___2024-11-13.log
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a> | logFileFolder: D:\VBAMonologger\src\var\log
</span></code></pre></div>
<h2 id="handlerconsole">HandlerConsole<a class="headerlink" href="#handlerconsole" title="Permanent link">&para;</a></h2>
<p>The handler <code>VBAMonologger.HandlerConsole</code> streams log messages to the Windows console (cmd.exe) by employing an HTTP-based client/server architecture. </p>
<p>The client sends log records as HTTP POST requests to the server. The server processes these requests and displays the log messages directly in the console output. This handler features a formatter that supports ANSI colors with <code>VBAMonologger.Formatter.FormatterANSIcoloredLine</code>.</p>
<p><img alt="VBAMonologger-output-WindowsConsole.png" src="../getting-started/VBAMonologger-output-WindowsConsole.png" /></p>
<pre class="mermaid"><code>classDiagram
    direction TB

    class HandlerConsole {
        - FormatterInterface pFormatter
        - Boolean pBubble
        - LogLevel pLogLevel
        - LOG_LEVELS pLevel
        - Scripting.FileSystemObject pFileSystemObject
        - String pTempFolderPowershellPrograms
        - String pPowershellProgramServerFilepath
        - Object pWriterFileStream
        - ConsoleWrapper pConsoleWrapper
        - String pUrlServer
        - Boolean pWithDebug
        - Boolean pWithANSIColorSupport
        - Boolean pWithNewlineForContextAndExtra
        + String hostnameServer
        + Integer portServer

        + construct(...): HandlerInterface
        + Property Get urlServer() As String
        + Property Get withDebug() As Boolean
        + Property Let withDebug(ByVal newValueForWithDebug As Boolean)
        + Property Get withANSIColorSupport() As Boolean
        + Property Let withANSIColorSupport(ByVal newValueForWithANSIColorSupport As Boolean)
        + Property Get withNewlineForContextAndExtra() As Boolean
        + Property Let withNewlineForContextAndExtra(ByVal newValueForWithNewlineForContextAndExtra As Boolean)
        + Sub startServerLogsViewer(Optional paramVerbose As Boolean)
        + Function isServerListening() As Boolean
        + Sub sendRequest(paramMessage As String)
        + Sub sendExitCommand()
        + Sub closeHandler()
        + Property Get formatter() As FormatterInterface
        + Property Set formatter(ByRef newFormatter As FormatterInterface)
        + Property Get bubble() As Boolean
        + Property Let bubble(ByVal value As Boolean)
        + Function isHandling(paramLogRecord As LogRecordInterface) As Boolean
        + Function handle(paramLogRecord As LogRecordInterface) As Boolean
        + Function handleBatch(paramLogRecords() As LogRecordInterface) As Boolean
        + Property Get level() As LOG_LEVELS
        + Property Let level(ByVal newLevel As LOG_LEVELS)
        + Function toString() As String
    }

    class HandlerInterface {
        &lt;&lt;Interface&gt;&gt;
    }

    %% Implementations and relationships
    HandlerConsole ..|&gt; HandlerInterface: Implements
    HandlerInterface --&gt; FormatterInterface : Has (property pFormatter)
    HandlerInterface --&gt; LOG_LEVELS : Uses
    HandlerConsole --&gt; FileSystemObject : Uses
    HandlerConsole --&gt; ADODB-Stream : Uses
    HandlerConsole --&gt; ConsoleWrapper : Uses</code></pre>
<h3 id="vbamonologger-http-client">VBAMonologger HTTP client<a class="headerlink" href="#vbamonologger-http-client" title="Permanent link">&para;</a></h3>
<p>The client implementation resides in the <code>sendRequest</code> method of the <code>HandlerConsole</code> class. </p>
<p>This VBA client is initialized using <code>CreateObject("MSXML2.XMLHTTP")</code>, which is a common method for making HTTP requests in VBA.</p>
<div class="language-vbscript highlight"><span class="filename">VBAMonologger.Handler.HandlerConsole.sendRequest()</span><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">Public</span><span class="w"> </span><span class="kd">Sub</span><span class="w"> </span><span class="nf">sendRequest</span><span class="p">(</span><span class="n">paramMessage</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="nb">String</span><span class="p">)</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">    </span><span class="kd">Dim</span><span class="w"> </span><span class="nv">http</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Object</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="kd">Dim</span><span class="w"> </span><span class="nv">message</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="nb">String</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span><span class="c1">&#39; Try to connect to VBAMonologger HTTP server logs viewer</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="n">withDebug</span><span class="w"> </span><span class="k">Then</span><span class="w"> </span><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;[DEBUG] HandlerConsole::sendRequest | Try to send request to VBAMonologger server on: &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">urlServer</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">    </span><span class="k">Set</span><span class="w"> </span><span class="n">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">CreateObject</span><span class="p">(</span><span class="s2">&quot;MSXML2.XMLHTTP&quot;</span><span class="p">)</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="n">Open</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">urlServer</span><span class="p">,</span><span class="w"> </span><span class="no">False</span><span class="w"> </span><span class="c1">&#39; False = Request should be handled synchronously</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">    </span><span class="c1">&#39; Send request to server</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="n">setRequestHeader</span><span class="w"> </span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;application/x-www-form-urlencoded&quot;</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="n">setRequestHeader</span><span class="w"> </span><span class="s2">&quot;User-Agent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;VBAMonologger VBA client&quot;</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="n">setRequestHeader</span><span class="w"> </span><span class="s2">&quot;Cache-Control&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;no-cache&quot;</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="n">setRequestHeader</span><span class="w"> </span><span class="s2">&quot;Connection&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;keep-alive&quot;</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">    </span><span class="n">http</span><span class="p">.</span><span class="n">send</span><span class="w"> </span><span class="n">paramMessage</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="n">withDebug</span><span class="w"> </span><span class="k">Then</span><span class="w"> </span><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;[DEBUG] HandlerConsole::sendRequest | The request was sent to the server with body message: &quot;&quot;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">paramMessage</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;&quot;</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">    </span><span class="c1">&#39; Received and read the response&#39;s server</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">    </span><span class="kd">Dim</span><span class="w"> </span><span class="nv">responseBody</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="nb">String</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">    </span><span class="kd">Dim</span><span class="w"> </span><span class="nv">responseCode</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Integer</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">    </span><span class="n">responseBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="n">responseText</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">    </span><span class="n">responseCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="n">Status</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="n">withDebug</span><span class="w"> </span><span class="k">Then</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">        </span><span class="k">Select</span><span class="w"> </span><span class="k">Case</span><span class="w"> </span><span class="n">responseCode</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">            </span><span class="k">Case</span><span class="w"> </span><span class="mi">200</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">                </span><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;[DEBUG] HandlerConsole::sendRequest | The server has responded successfully (200 - OK): &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">responseBody</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">            </span><span class="k">Case</span><span class="w"> </span><span class="mi">404</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">                </span><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;[DEBUG] HandlerConsole::sendRequest | The server responded an error (404 - resource not found).&quot;</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">            </span><span class="k">Case</span><span class="w"> </span><span class="k">Else</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">                </span><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;[DEBUG] HandlerConsole::sendRequest | Unexpected server response with HTTP code: &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">responseCode</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; and body response: &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">responseBody</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w">        </span><span class="k">End</span><span class="w"> </span><span class="k">Select</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w">    </span><span class="k">End</span><span class="w"> </span><span class="k">If</span>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="n">responseCode</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="k">Then</span>
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="w">        </span><span class="nb">Err</span><span class="p">.</span><span class="n">Raise</span><span class="w"> </span><span class="no">vbObjectError</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;VBAMonologger.Handler.HandlerConsole::sendRequest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Unexpected server response with HTTP code: &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">responseCode</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; and body response: &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">responseBody</span>
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="w">    </span><span class="k">End</span><span class="w"> </span><span class="k">If</span>
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="k">End</span><span class="w"> </span><span class="k">Sub</span>
</span></code></pre></div>
<p>The handler does nothing more than sending an HTTP request with the formatted log record into message to the VBAMonologger server logs viewer, in order to display it in console.</p>
<div class="language-vbscript highlight"><span class="filename">VBAMonologger.Handler.HandlerConsole.handle()</span><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">Private</span><span class="w"> </span><span class="kd">Function</span><span class="w"> </span><span class="nf">HandlerInterface_handle</span><span class="p">(</span><span class="n">paramLogRecord</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">LogRecordInterface</span><span class="p">)</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Boolean</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="kd">Dim</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Boolean</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="ow">Not</span><span class="w"> </span><span class="n">HandlerInterface_isHandling</span><span class="p">(</span><span class="n">paramLogRecord</span><span class="p">)</span><span class="w"> </span><span class="k">Then</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">False</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="k">Else</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">        </span><span class="kd">Dim</span><span class="w"> </span><span class="nv">formattedMessage</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="nb">String</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">        </span><span class="n">formattedMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VBA</span><span class="p">.</span><span class="nb">CStr</span><span class="o">$</span><span class="p">(</span><span class="n">pformatter</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">paramLogRecord</span><span class="p">))</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">        </span><span class="n">formattedMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VBA</span><span class="p">.</span><span class="nb">Replace</span><span class="o">$</span><span class="p">(</span><span class="n">formattedMessage</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="no">vbCrLf</span><span class="p">)</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">        </span><span class="c1">&#39; Call VBAMonologger client logs sender in order to send a request to VBAMonologger server logs viewer (i.e. send a message to show into server&#39;s output)</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">        </span><span class="k">Call</span><span class="w"> </span><span class="n">sendRequest</span><span class="p">(</span><span class="n">formattedMessage</span><span class="p">)</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">True</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">    </span><span class="k">End</span><span class="w"> </span><span class="k">If</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="no">True</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pBubble</span><span class="p">)</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w">    </span><span class="n">HandlerInterface_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="k">End</span><span class="w"> </span><span class="k">Function</span>
</span></code></pre></div>
<h3 id="vbamonologger-http-server-logs-viewer">VBAMonologger HTTP server logs viewer<a class="headerlink" href="#vbamonologger-http-server-logs-viewer" title="Permanent link">&para;</a></h3>
<h4 id="testing-the-server-manually-in-powershell">Testing the server manually in powershell<a class="headerlink" href="#testing-the-server-manually-in-powershell" title="Permanent link">&para;</a></h4>
<p>For those interested in testing the PowerShell server, you can easily start it manually with a simple command. Notes, that you can modify the server's hostname and port using the corresponding parameters.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>cd .\src\powershell\
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>powershell .\VBAMonologgerServerLogsViewer.ps1 -Verbose
</span></code></pre></div>
<p><img alt="VBAMonologgerServerLogsViewer-start-server.png" src="VBAMonologgerServerLogsViewer-start-server.png" /></p>
<p>In the same folder, you can find a PowerShell client for testing purposes, which allows you to send requests to the VBAmonologger server. In reality, this powerShell client is not used within the library. The real client implementation resides in the <code>sendRequest</code> method of the <code>HandlerConsole</code> class. This VBA client is initialized using <code>CreateObject("MSXML2.XMLHTTP")</code>, which is a common method for making HTTP requests in VBA.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>cd .\src\powershell\
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>.\VBAMonologgerDummyClient.ps1 -message &quot;I believe I can fly!&quot;
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>.\VBAMonologgerDummyClient.ps1 -message &quot;I believe I can touch the sky!&quot;
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>.\VBAMonologgerDummyClient.ps1 -message &quot;exit&quot;
</span></code></pre></div>
<div style="position: relative; display: inline-block;">
    <a title="Click to play" href="./VBAMonologgerServerLogsViewerAndClientPowershell.gif">
        <img src="./VBAMonologgerServerLogsViewerAndClientPowershell_end.png" alt="Click to play" style="cursor: pointer;" />
    </a>
</div>

<p>To view the full code of VBA Monologger server logs viewer, please visit the following here:  <a href="https://github.com/6i-software/vba-monologger/blob/main/src/powershell/VBAMonologgerServerLogsViewer.ps1">VBAMonologgerServerLogsViewer.ps1</a>.</p>
<h4 id="create-an-http-server-in-powershell">Create an HTTP server in powershell<a class="headerlink" href="#create-an-http-server-in-powershell" title="Permanent link">&para;</a></h4>
<p>Just use the <code>System.Net.HttpListener</code> library, as fallows.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">function</span> <span class="n">_createHTTPServer</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="p">{</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>    <span class="k">try</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>    <span class="p">{</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>        <span class="nv">$server</span> <span class="p">=</span> <span class="no">[System.Net.HttpListener]</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>        <span class="nv">$server</span><span class="p">.</span><span class="n">Prefixes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>            <span class="s2">&quot;http://&quot;</span> <span class="p">+</span> <span class="nv">$Global:hostname</span> <span class="p">+</span> <span class="s2">&quot;:&quot;</span> <span class="p">+</span> <span class="nv">$Global:port</span> <span class="p">+</span> <span class="s2">&quot;/&quot;</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>        <span class="p">)</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>        <span class="nv">$server</span><span class="p">.</span><span class="n">Start</span><span class="p">()</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>        <span class="no">[console]</span><span class="p">::</span><span class="n">WriteLine</span><span class="p">(</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>            <span class="s2">&quot;[DEBUG] Server is listening on : &lt;h&gt;&quot;&quot;http://&quot;</span> <span class="p">+</span> 
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>            <span class="nv">$Global:hostname</span> <span class="p">+</span> <span class="s2">&quot;:&quot;</span> <span class="p">+</span> 
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>            <span class="nv">$Global:port</span> <span class="p">+</span> <span class="s2">&quot;&quot;&quot;&lt;/h&gt;&quot;</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>        <span class="p">)</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>    <span class="p">}</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>    <span class="k">catch</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>    <span class="p">{</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>        <span class="no">[console]</span><span class="p">::</span><span class="n">WriteLine</span><span class="p">(</span><span class="s2">&quot;[ERROR] Creation of server encountered an critical error. It is possible that the HTTP server&#39;s port: &quot;</span> <span class="p">+</span> <span class="nv">$Global:port</span> <span class="p">+</span> <span class="s2">&quot;, is already in use by another application or process.</span><span class="se">`n</span><span class="s2">$_&quot;</span><span class="p">)</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>        <span class="n">Exit</span> <span class="n">1</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>    <span class="p">}</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>    <span class="k">return</span> <span class="nv">$server</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="p">}</span>
</span></code></pre></div>
<p>To stop the server, we add this function.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">function</span> <span class="n">_stopHTTPServer</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="p">{</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>    <span class="k">param</span> <span class="p">([</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span> <span class="p">=</span> <span class="nv">$true</span><span class="p">)]</span> <span class="no">[System.Net.HttpListener]</span> <span class="nv">$server</span><span class="p">)</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>    <span class="nv">$server</span><span class="p">.</span><span class="n">Stop</span><span class="p">()</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    <span class="no">[console]</span><span class="p">::</span><span class="n">WriteLine</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">`n</span><span class="s2">Server shutdown, bye bye !&quot;</span><span class="p">)</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>And to start the server we add this function. This is a minimal first version of VBAMonologger server logs viewer with basic processing. It simply displays the client's response. Nothing more, nothing less.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">function</span> <span class="n">_startHTTPServer</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="p">{</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>    <span class="k">param</span> <span class="p">([</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span> <span class="p">=</span> <span class="nv">$true</span><span class="p">)]</span> <span class="no">[System.Net.HttpListener]</span> <span class="nv">$server</span><span class="p">)</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>    <span class="nv">$continue</span> <span class="p">=</span> <span class="nv">$true</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>    <span class="k">while</span> <span class="p">(</span><span class="nv">$continue</span><span class="p">)</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>    <span class="p">{</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>        <span class="no">[console]</span><span class="p">::</span><span class="n">WriteLine</span><span class="p">((</span><span class="s2">&quot;Waiting for new client connection...&quot;</span><span class="p">)</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>        <span class="nv">$context</span> <span class="p">=</span> <span class="nv">$server</span><span class="p">.</span><span class="n">GetContext</span><span class="p">()</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>        <span class="nv">$request</span> <span class="p">=</span> <span class="nv">$context</span><span class="p">.</span><span class="n">Request</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>        <span class="nv">$response</span> <span class="p">=</span> <span class="nv">$context</span><span class="p">.</span><span class="n">Response</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>        <span class="no">[console]</span><span class="p">::</span><span class="n">WriteLine</span><span class="p">((</span><span class="s2">&quot;Connection established by a new client.&quot;</span><span class="p">)</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>        <span class="c"># Read client request (with support encoding UTF-8)</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>        <span class="nv">$reader</span> <span class="p">=</span> <span class="no">[System.IO.StreamReader]</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>            <span class="nv">$request</span><span class="p">.</span><span class="n">InputStream</span><span class="p">,</span> <span class="no">[System.Text.Encoding]</span><span class="p">::</span><span class="n">UTF8</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>        <span class="p">)</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>        <span class="nv">$message</span> <span class="p">=</span> <span class="nv">$reader</span><span class="p">.</span><span class="n">ReadToEnd</span><span class="p">()</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>        <span class="no">[console]</span><span class="p">::</span><span class="n">WriteLine</span><span class="p">((</span><span class="s2">&quot;Request received from the new client.&quot;</span><span class="p">)</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>        <span class="no">[console]</span><span class="p">::</span><span class="n">WriteLine</span><span class="p">(</span><span class="nv">$message</span><span class="p">)</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>        <span class="c"># Preapre server reponse</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>        <span class="nv">$responseString</span> <span class="p">=</span> <span class="s2">&quot;Request received! &quot;</span> <span class="p">+</span> <span class="nv">$message</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>        <span class="c"># Add custom headers </span>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>        <span class="nv">$response</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;Server&quot;</span><span class="p">,</span> <span class="s2">&quot;VBAMonologger HTTP Server&quot;</span><span class="p">)</span>
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a>        <span class="nv">$response</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;X-Powered-By&quot;</span><span class="p">,</span> <span class="s2">&quot;PowerShell 5&quot;</span><span class="p">)</span>
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>        <span class="nv">$response</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a>            <span class="s2">&quot;X-Request-Received&quot;</span><span class="p">,</span>
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a>            <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">ToString</span><span class="p">(</span><span class="s2">&quot;yyyy-MM-ddTHH:mm:ss&quot;</span><span class="p">)</span>
</span><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a>        <span class="p">)</span>
</span><span id="__span-21-32"><a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a>
</span><span id="__span-21-33"><a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a>        <span class="c"># Send server response (with support encoding UTF-8)</span>
</span><span id="__span-21-34"><a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a>        <span class="nv">$response</span><span class="p">.</span><span class="n">StatusCode</span> <span class="p">=</span> <span class="n">200</span>
</span><span id="__span-21-35"><a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a>        <span class="nv">$response</span><span class="p">.</span><span class="n">ContentType</span> <span class="p">=</span> <span class="s2">&quot;text/plain; charset=utf-8&quot;</span>
</span><span id="__span-21-36"><a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a>        <span class="nv">$buffer</span> <span class="p">=</span> <span class="no">[System.Text.Encoding]</span><span class="p">::</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="nv">$responseString</span><span class="p">)</span>
</span><span id="__span-21-37"><a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a>        <span class="nv">$response</span><span class="p">.</span><span class="n">OutputStream</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="nv">$buffer</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span> <span class="nv">$buffer</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
</span><span id="__span-21-38"><a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a>        <span class="nv">$response</span><span class="p">.</span><span class="n">Close</span><span class="p">()</span>
</span><span id="__span-21-39"><a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a>    <span class="p">}</span>
</span><span id="__span-21-40"><a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="enhanced-server-processing-requests-client">Enhanced server processing request's client<a class="headerlink" href="#enhanced-server-processing-requests-client" title="Permanent link">&para;</a></h4>
<p>Our PowerShell-based HTTP server has been designed to handle client requests in order to show the body of the request into console. With this feature we can show a log record given by a client. To enhance the server's capabilities, we've added a feature that allows it to identify and process specific stop commands. This ensures the server can shut down smoothly. Upon receiving a stop command, the server acknowledges it, optionally waits for a designated time, and then stops further processing. </p>
<p>If a client sends a message containing <code>exit</code>, <code>stop</code>, or <code>stop-server</code> in the body, the server will initiate its shutdown process. This feature ensures that the server acknowledges the stop command, processes it, and halts further operations smoothly. Additionally, it's possible to delay the shutdown process by a specified number of milliseconds using the -wait option. For example, including <code>-wait 2000</code> in the command will delay the shutdown by 2000 milliseconds.</p>
<p>This is achieved through the following code snippet:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nv">$message</span> <span class="p">=</span> <span class="nv">$reader</span><span class="p">.</span><span class="n">ReadToEnd</span><span class="p">()</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="c"># Process client&#39;s request</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="nv">$command</span> <span class="p">=</span> <span class="nv">$message</span><span class="p">.</span><span class="n">ToLower</span><span class="p">()</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="c"># Check if `-wait` option  is given in request&#39;s command</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="nv">$waitTime</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$command</span> <span class="o">-like</span> <span class="s1">&#39;*-wait*&#39;</span><span class="p">)</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="p">{</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>    <span class="nv">$parts</span> <span class="p">=</span> <span class="nv">$command</span><span class="p">.</span><span class="n">Split</span><span class="p">()</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>    <span class="nv">$mainCommand</span> <span class="p">=</span> <span class="nv">$parts</span><span class="p">[</span><span class="n">0</span><span class="p">]</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>    <span class="nv">$waitForIndex</span> <span class="p">=</span> <span class="no">[Array]</span><span class="p">::</span><span class="n">IndexOf</span><span class="p">(</span><span class="nv">$parts</span><span class="p">,</span> <span class="s1">&#39;-wait&#39;</span><span class="p">)</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$waitForIndex</span> <span class="o">-ne</span> <span class="p">-</span><span class="n">1</span> <span class="o">-and</span> <span class="nv">$waitForIndex</span> <span class="p">+</span> <span class="n">1</span> <span class="o">-lt</span> <span class="nv">$parts</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>    <span class="p">{</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>        <span class="nv">$waitTime</span> <span class="p">=</span> <span class="no">[int]</span><span class="nv">$parts</span><span class="p">[</span><span class="nv">$waitForIndex</span> <span class="p">+</span> <span class="n">1</span><span class="p">]</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>    <span class="p">}</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="p">}</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="k">else</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="p">{</span>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>    <span class="nv">$mainCommand</span> <span class="p">=</span> <span class="nv">$command</span>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="p">}</span>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$mainCommand</span> <span class="o">-eq</span> <span class="s1">&#39;exit&#39;</span> <span class="o">-or</span> <span class="nv">$mainCommand</span> <span class="o">-eq</span> <span class="s1">&#39;stop&#39;</span> <span class="o">-or</span> <span class="nv">$mainCommand</span> <span class="o">-eq</span> <span class="s1">&#39;stop-server&#39;</span><span class="p">)</span>
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="p">{</span>
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$waitTime</span> <span class="o">-gt</span> <span class="n">0</span><span class="p">)</span>
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>    <span class="p">{</span>
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>        <span class="n">_consoleDebug</span><span class="p">(</span><span class="s2">&quot;Stop command received, with a wait time for its execution of : &lt;h&gt;&quot;&quot;&quot;</span> <span class="p">+</span> <span class="nv">$waitTime</span> <span class="p">+</span> <span class="s2">&quot;&quot;&quot;&lt;/h&gt;.&quot;</span><span class="p">)</span>
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>        <span class="nb">Start-Sleep</span> <span class="n">-Milliseconds</span> <span class="nv">$waitTime</span>
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>        <span class="n">_consoleDebug</span><span class="p">(</span><span class="s2">&quot;Stop command received.&quot;</span><span class="p">)</span>
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a>    <span class="p">}</span>
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a>
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a>    <span class="nv">$responseString</span> <span class="p">=</span> <span class="s2">&quot;Stop command received and executed by the server.&quot;</span>
</span><span id="__span-22-34"><a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a>    <span class="nv">$continue</span> <span class="p">=</span> <span class="nv">$false</span>
</span><span id="__span-22-35"><a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a><span class="p">}</span>
</span><span id="__span-22-36"><a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a><span class="k">else</span>
</span><span id="__span-22-37"><a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a><span class="p">{</span>
</span><span id="__span-22-38"><a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a>    <span class="nv">$responseString</span> <span class="p">=</span> <span class="s2">&quot;Request received! &quot;</span> <span class="p">+</span> <span class="nv">$message</span>
</span><span id="__span-22-39"><a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a>    <span class="c"># Simply output message&#39;s request into console, in order to show log record</span>
</span><span id="__span-22-40"><a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a>    <span class="no">[console]</span><span class="p">::</span><span class="n">WriteLine</span><span class="p">(</span><span class="nv">$message</span><span class="p">)</span>
</span><span id="__span-22-41"><a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="enhanced-server-console-outputs">Enhanced server console outputs<a class="headerlink" href="#enhanced-server-console-outputs" title="Permanent link">&para;</a></h4>
<p>The provided PowerShell function enhances the console output with functions to handle and style messages. </p>
<p>These helper functions allow for dynamic styling of console messages, changing text colors and background colors based on the type of message. Debug messages are shown in gray, errors in red, and warnings in dark yellow.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">function</span> <span class="n">_consoleDebug</span><span class="p">()</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="p">{</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>    <span class="k">param</span> <span class="p">([</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span> <span class="p">=</span> <span class="nv">$true</span><span class="p">)]</span> <span class="no">[string]</span><span class="nv">$message</span><span class="p">)</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$VerbosePreference</span> <span class="o">-eq</span> <span class="s2">&quot;Continue&quot;</span><span class="p">)</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>    <span class="p">{</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>        <span class="n">_consoleLog</span> <span class="n">-message</span> <span class="nv">$message</span> <span class="n">-type</span> <span class="s2">&quot;debug&quot;</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>    <span class="p">}</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="p">}</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="k">function</span> <span class="n">_consoleError</span><span class="p">()</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="p">{</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>    <span class="k">param</span> <span class="p">([</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span> <span class="p">=</span> <span class="nv">$true</span><span class="p">)]</span> <span class="no">[string]</span><span class="nv">$message</span><span class="p">)</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>    <span class="n">_consoleLog</span> <span class="n">-message</span> <span class="nv">$message</span> <span class="n">-type</span> <span class="s2">&quot;error&quot;</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="p">}</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="k">function</span> <span class="n">_consoleWarning</span><span class="p">()</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="p">{</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>    <span class="k">param</span> <span class="p">([</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span> <span class="p">=</span> <span class="nv">$true</span><span class="p">)]</span> <span class="no">[string]</span><span class="nv">$message</span><span class="p">)</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>    <span class="n">_consoleLog</span> <span class="n">-message</span> <span class="nv">$message</span> <span class="n">-type</span> <span class="s2">&quot;warning&quot;</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="p">}</span>
</span></code></pre></div>
<p>The <code>_consoleLog</code> function centralizes the logging process, adjusting the style based on the message type (debug, error, warning, etc.). Other functions like <code>_consoleDebug</code>, <code>_consoleError</code>, and <code>_consoleWarning</code> call <code>_consoleLog</code> with appropriate parameters to handle different log types.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">function</span> <span class="n">_consoleLog</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="p">{</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    <span class="k">param</span> <span class="p">(</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span> <span class="p">=</span> <span class="nv">$true</span><span class="p">)]</span> <span class="no">[string]</span> <span class="nv">$message</span><span class="p">,</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span> <span class="p">=</span> <span class="nv">$true</span><span class="p">)]</span> <span class="no">[string]</span> <span class="nv">$type</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    <span class="p">)</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>    <span class="c"># Save current colors</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>    <span class="nv">$currentForegroundColor</span> <span class="p">=</span> <span class="no">[console]</span><span class="p">::</span><span class="n">ForegroundColor</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>    <span class="nv">$currentBackgroundColor</span> <span class="p">=</span> <span class="no">[console]</span><span class="p">::</span><span class="n">BackgroundColor</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>    <span class="nv">$currentHighlightForegroundColor</span> <span class="p">=</span> <span class="nv">$Global:highlightForegroundColor</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>    <span class="nv">$currentHighlightBackgroundColor</span> <span class="p">=</span> <span class="nv">$Global:highlightBackgroundColor</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>    <span class="c"># Prepare output message</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>    <span class="nv">$type</span> <span class="p">=</span> <span class="nv">$type</span><span class="p">.</span><span class="n">ToLower</span><span class="p">()</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>    <span class="k">switch</span> <span class="p">(</span><span class="nv">$type</span><span class="p">)</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>    <span class="p">{</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>        <span class="s2">&quot;debug&quot;</span> <span class="p">{</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>            <span class="k">if</span> <span class="p">(</span><span class="nv">$VerbosePreference</span> <span class="o">-eq</span> <span class="s2">&quot;Continue&quot;</span><span class="p">)</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>            <span class="p">{</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>                <span class="no">[console]</span><span class="p">::</span><span class="n">ForegroundColor</span> <span class="p">=</span> <span class="s2">&quot;DarkGray&quot;</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>                <span class="nv">$message</span> <span class="p">=</span> <span class="nv">$Global:prefixConsoleOutput</span> <span class="p">+</span> <span class="s2">&quot; [{0}] {1}&quot;</span> <span class="o">-f</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">ToString</span><span class="p">(),</span> <span class="nv">$message</span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>            <span class="p">}</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>        <span class="p">}</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>        <span class="s2">&quot;error&quot;</span> <span class="p">{</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>            <span class="no">[console]</span><span class="p">::</span><span class="n">ForegroundColor</span> <span class="p">=</span> <span class="s2">&quot;Red&quot;</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>            <span class="nv">$Global:highlightForegroundColor</span> <span class="p">=</span> <span class="s2">&quot;Yellow&quot;</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>            <span class="nv">$Global:highlightBackgroundColor</span> <span class="p">=</span> <span class="s2">&quot;DarkRed&quot;</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>            <span class="nv">$message</span> <span class="p">=</span> <span class="nv">$Global:prefixConsoleOutput</span> <span class="p">+</span> <span class="s2">&quot; [{0}] [ERROR] {1}&quot;</span> <span class="o">-f</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">ToString</span><span class="p">(),</span> <span class="nv">$message</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>        <span class="p">}</span>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>        <span class="s2">&quot;warning&quot;</span> <span class="p">{</span>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>            <span class="no">[console]</span><span class="p">::</span><span class="n">ForegroundColor</span> <span class="p">=</span> <span class="s2">&quot;DarkYellow&quot;</span>
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>            <span class="nv">$Global:highlightBackgroundColor</span> <span class="p">=</span> <span class="s2">&quot;DarkMagenta&quot;</span>
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a>            <span class="nv">$message</span> <span class="p">=</span> <span class="nv">$Global:prefixConsoleOutput</span> <span class="p">+</span> <span class="s2">&quot; [{0}] [WARNING] {1}&quot;</span> <span class="o">-f</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">ToString</span><span class="p">(),</span> <span class="nv">$message</span>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a>        <span class="p">}</span>
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a>        <span class="k">default</span> <span class="p">{</span>
</span><span id="__span-24-37"><a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a>            <span class="no">[console]</span><span class="p">::</span><span class="n">ForegroundColor</span> <span class="p">=</span> <span class="s2">&quot;White&quot;</span>
</span><span id="__span-24-38"><a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a>            <span class="nv">$message</span> <span class="p">=</span> <span class="nv">$Global:prefixConsoleOutput</span> <span class="p">+</span> <span class="s2">&quot; [{0}] {1}&quot;</span> <span class="o">-f</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">ToString</span><span class="p">(),</span> <span class="nv">$message</span>
</span><span id="__span-24-39"><a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a>        <span class="p">}</span>
</span><span id="__span-24-40"><a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a>    <span class="p">}</span>
</span><span id="__span-24-41"><a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a>    <span class="n">_consoleWriteStyles</span><span class="p">(</span><span class="nv">$message</span><span class="p">)</span>
</span><span id="__span-24-42"><a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a>
</span><span id="__span-24-43"><a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a>    <span class="c"># Restore previous colors</span>
</span><span id="__span-24-44"><a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a>    <span class="no">[console]</span><span class="p">::</span><span class="n">ForegroundColor</span> <span class="p">=</span> <span class="nv">$currentForegroundColor</span>
</span><span id="__span-24-45"><a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a>    <span class="no">[console]</span><span class="p">::</span><span class="n">BackgroundColor</span> <span class="p">=</span> <span class="nv">$currentBackgroundColor</span>
</span><span id="__span-24-46"><a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a>    <span class="nv">$Global:highlightForegroundColor</span> <span class="p">=</span> <span class="nv">$currentHighlightForegroundColor</span>
</span><span id="__span-24-47"><a id="__codelineno-24-47" name="__codelineno-24-47" href="#__codelineno-24-47"></a>    <span class="nv">$Global:highlightBackgroundColor</span> <span class="p">=</span> <span class="nv">$currentHighlightBackgroundColor</span>
</span><span id="__span-24-48"><a id="__codelineno-24-48" name="__codelineno-24-48" href="#__codelineno-24-48"></a><span class="p">}</span>
</span></code></pre></div>
<p>The <code>_consoleWriteStyles</code> function is designed to style console messages with custom colors. It looks for tags in the message that specify styling, such as changing text and background colors. When it finds these tags, it applies the specified styles to the text within the tags. If no tags are found, it writes the message with default console colors. The function ensures that the console's colors are restored to their original settings after applying the styles.</p>
<p>This function provides a feature of replacing tags <code>{h}{/h}</code> with according style <code>&lt;style=...&gt;...&lt;/s&gt;</code> in the message. This allows it to apply default styles to highlighted text within these tags.</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="k">function</span> <span class="n">_consoleWriteStyles</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="p">{</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>    <span class="k">param</span> <span class="p">(</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span> <span class="p">=</span> <span class="nv">$true</span><span class="p">)]</span> <span class="no">[string]</span><span class="nv">$message</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    <span class="p">)</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>    <span class="c"># Search tag {h}{/h} and replace it by its default styles</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>    <span class="nv">$message</span> <span class="p">=</span> <span class="nv">$message</span> <span class="o">-replace</span> <span class="s1">&#39;&lt;h&gt;(.*?)&lt;/h&gt;&#39;</span><span class="p">,</span> <span class="s2">&quot;&lt;style=</span><span class="se">`&quot;</span><span class="s2">foregroundColor:$highlightForegroundColor; backgroundColor:$highlightBackgroundColor;</span><span class="se">`&quot;</span><span class="s2">&gt;</span><span class="se">`$</span><span class="s2">{1}`&lt;/s&gt;&quot;</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>    <span class="c"># Regex used to capture styles</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>    <span class="nv">$regex</span> <span class="p">=</span> <span class="s1">&#39;&lt;style=&quot;([^&quot;]+)&quot;&gt;(.+?)&lt;/s&gt;&#39;</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>    <span class="nv">$regexStyleColor</span> <span class="p">=</span> <span class="s1">&#39;(?:foregroundColor:(?&lt;fgColor&gt;[^;]+);?)?(?:\s*backgroundColor:(?&lt;bgColor&gt;[^;]+);?)?&#39;</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>    <span class="nv">$lastIndex</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>    <span class="nv">$matchesStyles</span> <span class="p">=</span> <span class="no">[regex]</span><span class="p">::</span><span class="n">Matches</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$regex</span><span class="p">)</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$matchesStyles</span><span class="p">.</span><span class="n">Count</span> <span class="o">-eq</span> <span class="n">0</span><span class="p">)</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>    <span class="p">{</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>        <span class="c"># If no matches, write text with default style</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>        <span class="no">[console]</span><span class="p">::</span><span class="n">WriteLine</span><span class="p">(</span><span class="nv">$message</span><span class="p">)</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>    <span class="p">}</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>    <span class="k">else</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>    <span class="p">{</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>        <span class="c"># Saved current console colors</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>        <span class="nv">$currentForegroundColor</span> <span class="p">=</span> <span class="no">[console]</span><span class="p">::</span><span class="n">ForegroundColor</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>        <span class="nv">$currentBackgroundColor</span> <span class="p">=</span> <span class="no">[console]</span><span class="p">::</span><span class="n">BackgroundColor</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$match</span> <span class="k">in</span> <span class="nv">$matchesStyles</span><span class="p">)</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>        <span class="p">{</span>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>            <span class="nv">$captureStyles</span> <span class="p">=</span> <span class="nv">$match</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">Value</span>
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>            <span class="nv">$captureTextStyled</span> <span class="p">=</span> <span class="nv">$match</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="n">2</span><span class="p">].</span><span class="n">Value</span>
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a>            <span class="nv">$startIndex</span> <span class="p">=</span> <span class="nv">$match</span><span class="p">.</span><span class="n">Index</span>
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a>
</span><span id="__span-25-33"><a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a>            <span class="c"># Write text with default style before style bloc</span>
</span><span id="__span-25-34"><a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a>            <span class="k">if</span> <span class="p">(</span><span class="nv">$startIndex</span> <span class="p">-</span> <span class="nv">$lastIndex</span> <span class="o">-gt</span> <span class="n">0</span><span class="p">)</span>
</span><span id="__span-25-35"><a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a>            <span class="p">{</span>
</span><span id="__span-25-36"><a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a>                <span class="nv">$textBefore</span> <span class="p">=</span> <span class="nv">$message</span><span class="p">.</span><span class="n">Substring</span><span class="p">(</span><span class="nv">$lastIndex</span><span class="p">,</span> <span class="nv">$startIndex</span> <span class="p">-</span> <span class="nv">$lastIndex</span><span class="p">)</span>
</span><span id="__span-25-37"><a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a>                <span class="no">[console]</span><span class="p">::</span><span class="n">Write</span><span class="p">(</span><span class="nv">$textBefore</span><span class="p">)</span>
</span><span id="__span-25-38"><a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a>            <span class="p">}</span>
</span><span id="__span-25-39"><a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a>
</span><span id="__span-25-40"><a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a>            <span class="c"># Capture styles properties colors</span>
</span><span id="__span-25-41"><a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a>            <span class="nv">$styleMatch</span> <span class="p">=</span> <span class="no">[regex]</span><span class="p">::</span><span class="n">Match</span><span class="p">(</span><span class="nv">$captureStyles</span><span class="p">,</span> <span class="nv">$regexStyleColor</span><span class="p">)</span>
</span><span id="__span-25-42"><a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a>            <span class="nv">$foregroundColor</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$styleMatch</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s2">&quot;fgColor&quot;</span><span class="p">].</span><span class="n">Value</span><span class="p">)</span>
</span><span id="__span-25-43"><a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a>            <span class="p">{</span>
</span><span id="__span-25-44"><a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a>                <span class="nv">$styleMatch</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s2">&quot;fgColor&quot;</span><span class="p">].</span><span class="n">Value</span>
</span><span id="__span-25-45"><a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a>            <span class="p">}</span>
</span><span id="__span-25-46"><a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a>            <span class="k">else</span>
</span><span id="__span-25-47"><a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a>            <span class="p">{</span>
</span><span id="__span-25-48"><a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a>                <span class="nv">$currentForegroundColor</span>
</span><span id="__span-25-49"><a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a>            <span class="p">}</span>
</span><span id="__span-25-50"><a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a>            <span class="nv">$backgroundColor</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$styleMatch</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s2">&quot;bgColor&quot;</span><span class="p">].</span><span class="n">Value</span><span class="p">)</span>
</span><span id="__span-25-51"><a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a>            <span class="p">{</span>
</span><span id="__span-25-52"><a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a>                <span class="nv">$styleMatch</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s2">&quot;bgColor&quot;</span><span class="p">].</span><span class="n">Value</span>
</span><span id="__span-25-53"><a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a>            <span class="p">}</span>
</span><span id="__span-25-54"><a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a>            <span class="k">else</span>
</span><span id="__span-25-55"><a id="__codelineno-25-55" name="__codelineno-25-55" href="#__codelineno-25-55"></a>            <span class="p">{</span>
</span><span id="__span-25-56"><a id="__codelineno-25-56" name="__codelineno-25-56" href="#__codelineno-25-56"></a>                <span class="nv">$currentBackgroundColor</span>
</span><span id="__span-25-57"><a id="__codelineno-25-57" name="__codelineno-25-57" href="#__codelineno-25-57"></a>            <span class="p">}</span>
</span><span id="__span-25-58"><a id="__codelineno-25-58" name="__codelineno-25-58" href="#__codelineno-25-58"></a>
</span><span id="__span-25-59"><a id="__codelineno-25-59" name="__codelineno-25-59" href="#__codelineno-25-59"></a>            <span class="c"># Write capture text with colors</span>
</span><span id="__span-25-60"><a id="__codelineno-25-60" name="__codelineno-25-60" href="#__codelineno-25-60"></a>            <span class="no">[console]</span><span class="p">::</span><span class="n">ForegroundColor</span> <span class="p">=</span> <span class="nv">$foregroundColor</span>
</span><span id="__span-25-61"><a id="__codelineno-25-61" name="__codelineno-25-61" href="#__codelineno-25-61"></a>            <span class="no">[console]</span><span class="p">::</span><span class="n">BackgroundColor</span> <span class="p">=</span> <span class="nv">$backgroundColor</span>
</span><span id="__span-25-62"><a id="__codelineno-25-62" name="__codelineno-25-62" href="#__codelineno-25-62"></a>            <span class="no">[console]</span><span class="p">::</span><span class="n">Write</span><span class="p">(</span><span class="nv">$captureTextStyled</span><span class="p">)</span>
</span><span id="__span-25-63"><a id="__codelineno-25-63" name="__codelineno-25-63" href="#__codelineno-25-63"></a>            <span class="no">[console]</span><span class="p">::</span><span class="n">ForegroundColor</span> <span class="p">=</span> <span class="nv">$currentForegroundColor</span>
</span><span id="__span-25-64"><a id="__codelineno-25-64" name="__codelineno-25-64" href="#__codelineno-25-64"></a>            <span class="no">[console]</span><span class="p">::</span><span class="n">BackgroundColor</span> <span class="p">=</span> <span class="nv">$currentBackgroundColor</span>
</span><span id="__span-25-65"><a id="__codelineno-25-65" name="__codelineno-25-65" href="#__codelineno-25-65"></a>
</span><span id="__span-25-66"><a id="__codelineno-25-66" name="__codelineno-25-66" href="#__codelineno-25-66"></a>            <span class="c"># Update position after regexp match</span>
</span><span id="__span-25-67"><a id="__codelineno-25-67" name="__codelineno-25-67" href="#__codelineno-25-67"></a>            <span class="nv">$lastIndex</span> <span class="p">=</span> <span class="nv">$startIndex</span> <span class="p">+</span> <span class="nv">$match</span><span class="p">.</span><span class="n">Length</span>
</span><span id="__span-25-68"><a id="__codelineno-25-68" name="__codelineno-25-68" href="#__codelineno-25-68"></a>        <span class="p">}</span>
</span><span id="__span-25-69"><a id="__codelineno-25-69" name="__codelineno-25-69" href="#__codelineno-25-69"></a>
</span><span id="__span-25-70"><a id="__codelineno-25-70" name="__codelineno-25-70" href="#__codelineno-25-70"></a>        <span class="c"># Write remaining text after the last matches with default style</span>
</span><span id="__span-25-71"><a id="__codelineno-25-71" name="__codelineno-25-71" href="#__codelineno-25-71"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$lastIndex</span> <span class="o">-lt</span> <span class="nv">$message</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
</span><span id="__span-25-72"><a id="__codelineno-25-72" name="__codelineno-25-72" href="#__codelineno-25-72"></a>        <span class="p">{</span>
</span><span id="__span-25-73"><a id="__codelineno-25-73" name="__codelineno-25-73" href="#__codelineno-25-73"></a>            <span class="nv">$remainingText</span> <span class="p">=</span> <span class="nv">$message</span><span class="p">.</span><span class="n">Substring</span><span class="p">(</span><span class="nv">$lastIndex</span><span class="p">)</span>
</span><span id="__span-25-74"><a id="__codelineno-25-74" name="__codelineno-25-74" href="#__codelineno-25-74"></a>            <span class="no">[console]</span><span class="p">::</span><span class="n">Write</span><span class="p">(</span><span class="nv">$remainingText</span><span class="p">)</span>
</span><span id="__span-25-75"><a id="__codelineno-25-75" name="__codelineno-25-75" href="#__codelineno-25-75"></a>        <span class="p">}</span>
</span><span id="__span-25-76"><a id="__codelineno-25-76" name="__codelineno-25-76" href="#__codelineno-25-76"></a>        <span class="no">[console]</span><span class="p">::</span><span class="n">WriteLine</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-25-77"><a id="__codelineno-25-77" name="__codelineno-25-77" href="#__codelineno-25-77"></a>    <span class="p">}</span>
</span><span id="__span-25-78"><a id="__codelineno-25-78" name="__codelineno-25-78" href="#__codelineno-25-78"></a><span class="p">}</span>
</span></code></pre></div>
<p>So you can enhance the visibility of your log messages in the console output by utilizing specific styling tags. One such tag is <code>&lt;h&gt;&lt;/h&gt;</code>, which is used to highlight critical parts of the message, making them stand out. For example:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">_consoleError</span><span class="p">(</span><span class="s2">&quot;Creation of server encountered an &lt;h&gt;critical error&lt;/h&gt;. It is possible that the HTTP server&#39;s port: &lt;h&gt;&quot;</span> <span class="p">+</span> <span class="nv">$Global:port</span> <span class="p">+</span> <span class="s2">&quot;&lt;/h&gt;, is already in use by another application or process.</span><span class="se">`n</span><span class="s2">$_&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Will produces this output:</p>
<p><img alt="VBAMonologgerServerLogsViewer-enhanced-colors.png" src="VBAMonologgerServerLogsViewer-enhanced-colors.png" /></p>
<h4 id="embedding-powershell-server-code-into-a-vba-library">Embedding PowerShell server code into a VBA library<a class="headerlink" href="#embedding-powershell-server-code-into-a-vba-library" title="Permanent link">&para;</a></h4>
<p>In VBAMonologger library, a notable feature is the integration of PowerShell code directly within the xlam (Excel Add-In) library. The PowerShell script that manages the server is embedded within the library itself. </p>
<p>Heres how it works:</p>
<ul>
<li>The function <code>getPowershellCodeServerLogsViewer</code> contains the PowerShell code. This function constructs the script as a string, including headers and the main body of the code, which is designed to set up an HTTP server for displaying log messages sent by clients. </li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>Private Function getPowershellCodeServerLogsViewer() As String
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>     Dim code As String
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>     code = &quot;&quot;
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>     &#39; Header code source file
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>     code = code &amp; &quot;# ------------------------------------- #&quot; &amp; vbCrLf
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>     code = code &amp; &quot;#                                       #&quot; &amp; vbCrLf
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>     code = code &amp; &quot;#    VBA Monologger                     #&quot; &amp; vbCrLf
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>     code = code &amp; &quot;#    Copyright  2024, 6i software      #&quot; &amp; vbCrLf
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>     code = code &amp; &quot;#                                       #&quot; &amp; vbCrLf
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>     code = code &amp; &quot;# ------------------------------------- #&quot; &amp; vbCrLf
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>     code = code &amp; &quot;#&quot; &amp; vbCrLf
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>     (...)
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>     getPowershellCodeServerLogsViewer = code
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>End Function
</span></code></pre></div>
<ul>
<li>During the initialization of an instance of <code>HandlerConsole</code>, various configurations are set, including the creation of a temporary folder (with the <code>createPowershellTempfolder</code> method), and the creation of the powershell file (with the <code>createPowershellFileVBAMonologgerServer</code> method).</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>Private Sub Class_Initialize()
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>    &#39; Configuration and initialization steps.
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>    pTempFolderPowershellPrograms = Environ(&quot;TEMP&quot;) &amp; &quot;\VBAMonologger\powershell&quot;
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>    pPowershellProgramServerFilepath = pTempFolderPowershellPrograms &amp; &quot;\VBAMonologgerHTTPServerLogsViewer.ps1&quot;
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>    createPowershellTempfolder
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>    createPowershellFileVBAMonologgerServer
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>End Sub
</span></code></pre></div>
<ul>
<li>The PowerShell file is created using the <code>pWriterFileStream</code> member, which is an ADODB Stream object. This object is available in Microsoft ActiveX Data Objects and is used to write the file in UTF-8 encoding.</li>
</ul>
<div class="language-vbscript highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">Private</span><span class="w"> </span><span class="kd">Sub</span><span class="w"> </span><span class="nf">createPowershellFileVBAMonologgerServer</span><span class="p">()</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">    </span><span class="kd">Dim</span><span class="w"> </span><span class="nv">serverFile</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Object</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">    </span><span class="kd">Dim</span><span class="w"> </span><span class="nv">lines</span><span class="p">()</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="nb">String</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">    </span><span class="kd">Dim</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Long</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">    </span><span class="c1">&#39; Create file code source, only if does not exist</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="ow">Not</span><span class="w"> </span><span class="n">pFileSystemObject</span><span class="p">.</span><span class="n">FileExists</span><span class="p">(</span><span class="n">pPowershellProgramServerFilepath</span><span class="p">)</span><span class="w"> </span><span class="k">Then</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">    </span><span class="c1">&#39; Get powershell program of &#39;VBAMonologger server logs viewer&#39;</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">    </span><span class="kd">Dim</span><span class="w"> </span><span class="nv">serverPowershellCode</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="nb">String</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">    </span><span class="n">serverPowershellCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPowershellCodeServerLogsViewer</span><span class="p">()</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">    </span><span class="c1">&#39; Ignore errors if logfile does not exist</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">    </span><span class="k">On</span><span class="w"> </span><span class="k">Error</span><span class="w"> </span><span class="k">Resume</span><span class="w"> </span><span class="k">Next</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">    </span><span class="n">pWriterFileStream</span><span class="p">.</span><span class="n">Open</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">    </span><span class="n">pWriterFileStream</span><span class="p">.</span><span class="n">LoadFromFile</span><span class="w"> </span><span class="n">pPowershellProgramServerFilepath</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">    </span><span class="k">On</span><span class="w"> </span><span class="k">Error</span><span class="w"> </span><span class="k">GoTo</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">    </span><span class="c1">&#39; Split code source when a \n (newline) is encountered.</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">    </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Split</span><span class="p">(</span><span class="n">serverPowershellCode</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;\n&quot;</span><span class="p">)</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="w">    </span><span class="c1">&#39; Write each line code, adding an empty line for each \n</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">    </span><span class="k">For</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">LBound</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="nb">UBound</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="w">        </span><span class="n">pWriterFileStream</span><span class="p">.</span><span class="n">WriteText</span><span class="w"> </span><span class="n">lines</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="c1">&#39; 1: Writes a text string and a line separator character to stream</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="w">    </span><span class="k">Next</span><span class="w"> </span><span class="n">i</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a><span class="w">    </span><span class="n">pWriterFileStream</span><span class="p">.</span><span class="n">SaveToFile</span><span class="w"> </span><span class="n">pPowershellProgramServerFilepath</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="c1">&#39; 2: Overwrite file</span>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a><span class="w">    </span><span class="c1">&#39; Final check</span>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a><span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="ow">Not</span><span class="w"> </span><span class="n">pFileSystemObject</span><span class="p">.</span><span class="n">FileExists</span><span class="p">(</span><span class="n">pPowershellProgramServerFilepath</span><span class="p">)</span><span class="w"> </span><span class="k">Then</span>
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a><span class="w">        </span><span class="nb">Err</span><span class="p">.</span><span class="n">Raise</span><span class="w"> </span><span class="no">vbObjectError</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;VBAMonologger.Handler.HandlerConsole::createPowershellFileVBAMonologgerServer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Failed to create the powershell file: &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">pPowershellProgramServerFilepath</span>
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a><span class="w">     </span><span class="n">EndIf</span>
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a><span class="k">End</span><span class="w"> </span><span class="k">Sub</span>
</span></code></pre></div>
<ul>
<li>Upon initialization, the library ensures that the necessary directories are created and the PowerShell script is written to the specified file path. This setup allows the VBAMonologger server logs viewer to run seamlessly, providing real-time log monitoring capabilities.</li>
</ul>
<h4 id="how-to-start-the-vbamonologger-server-logs-viewer-from-vba">How to start the VBAMonologger server logs viewer from VBA<a class="headerlink" href="#how-to-start-the-vbamonologger-server-logs-viewer-from-vba" title="Permanent link">&para;</a></h4>
<p>To do it, we use a console wrapper (`VBAMonologger.Utils.ConsoleWrapper``)</p>
<div class="language-vbscript highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">Public</span><span class="w"> </span><span class="kd">Sub</span><span class="w"> </span><span class="nf">startServerLogsViewer</span><span class="p">(</span><span class="w"> </span><span class="n">_</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">    </span><span class="n">Optional</span><span class="w"> </span><span class="k">ByVal</span><span class="w"> </span><span class="n">paramVerbose</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">False</span><span class="w"> </span><span class="n">_</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="p">)</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">    </span><span class="c1">&#39; Check if the file exists using FileSystemObject</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="ow">Not</span><span class="w"> </span><span class="n">pFileSystemObject</span><span class="p">.</span><span class="n">FileExists</span><span class="p">(</span><span class="n">pPowershellProgramServerFilepath</span><span class="p">)</span><span class="w"> </span><span class="k">Then</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w">        </span><span class="nb">Err</span><span class="p">.</span><span class="n">Raise</span><span class="w"> </span><span class="no">vbObjectError</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HandlerConsole::startServerLogsViewer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Powershell program file for *VBAMonologger HTTP server logs viewer* was not found: &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">pPowershellProgramServerFilepath</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="w">        </span><span class="k">Exit</span><span class="w"> </span><span class="kd">Sub</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="w">    </span><span class="nf">End</span><span class="w"> </span><span class="k">If</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="w">    </span><span class="kd">Dim</span><span class="w"> </span><span class="nv">shellCommand</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="nb">String</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="w">    </span><span class="n">shellCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cmd.exe /K&quot;</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="w">    </span><span class="n">shellCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shellCommand</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; powershell.exe -File &quot;&quot;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">pPowershellProgramServerFilepath</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;&quot;</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="w">    </span><span class="n">shellCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shellCommand</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; -port&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">portServer</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="w">    </span><span class="n">shellCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shellCommand</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; -hostname&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">hostnameServer</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="w">    </span><span class="n">shellCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shellCommand</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; -titleConsole &quot;&quot;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">TITLE_CONSOLE_WINDOW</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;&quot;</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="n">paramVerbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">True</span><span class="w"> </span><span class="k">Then</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="w">        </span><span class="n">shellCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shellCommand</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; -Verbose&quot;</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="w">        </span><span class="n">pConsoleWrapper</span><span class="p">.</span><span class="n">withDebug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">True</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="w">    </span><span class="k">End</span><span class="w"> </span><span class="k">If</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a><span class="w">    </span><span class="c1">&#39; If console (cmd.exe) with the title &quot;TitleConsoleWindow&quot; already exist... we do nothing with createConsole!</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a><span class="w">    </span><span class="n">pConsoleWrapper</span><span class="p">.</span><span class="n">createConsole</span><span class="w"> </span><span class="n">shellCommand</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a><span class="w">    </span><span class="c1">&#39; Check server status</span>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a><span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="n">isServerListening</span><span class="p">()</span><span class="w"> </span><span class="k">Then</span>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a><span class="w">        </span><span class="k">If</span><span class="w"> </span><span class="n">withDebug</span><span class="w"> </span><span class="k">Then</span><span class="w"> </span><span class="nb">Debug</span><span class="p">.</span><span class="n">Print</span><span class="w"> </span><span class="s2">&quot;[DEBUG] HandlerConsole::startServerLogsViewer | The VBAMonologger server is listening on: &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">urlServer</span>
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a><span class="w">    </span><span class="k">Else</span>
</span><span id="__span-30-29"><a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a><span class="w">        </span><span class="nb">Err</span><span class="p">.</span><span class="n">Raise</span><span class="w"> </span><span class="no">vbObjectError</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;HandlerConsole::startServerLogsViewer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Unable to start the VBAMonologger server. It&#39;s not listening on: &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">urlServer</span>
</span><span id="__span-30-30"><a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a><span class="w">    </span><span class="k">End</span><span class="w"> </span><span class="k">If</span>
</span><span id="__span-30-31"><a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a><span class="k">End</span><span class="w"> </span><span class="k">Sub</span>
</span></code></pre></div>







  
  



  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="formatter.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Formatter">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Formatter
              </div>
            </div>
          </a>
        
        
          
          <a href="pre-processor.html" class="md-footer__link md-footer__link--next" aria-label="Next: Pre-processor">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Pre-processor
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024, 6i-software - 2o1oo
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/v20100v" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:vb20100bv@gmail.com?subject=[6i-VBA%20Monologger]" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  


  
    
  



  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.code.copy", "content.tabs.link", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.expand", "navigation.tabs", "navigation.top", "navigation.tracking", "navigation.instant", "toc.follow", "search.highlight", "search.share", "search.suggest"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f13b1293.min.js"></script>
      
    
  </body>
</html>